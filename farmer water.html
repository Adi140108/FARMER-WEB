<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>Smart Irrigation Advisor</title>
<style>
  body {
    font-family: 'Poppins', sans-serif;
    background: linear-gradient(135deg, #74b9ff, #a29bfe);
    color: #fff;
    text-align: center;
    padding: 40px;
  }
  .container {
    background: rgba(255, 255, 255, 0.15);
    border-radius: 15px;
    padding: 30px;
    max-width: 550px;
    margin: auto;
    box-shadow: 0 4px 10px rgba(0,0,0,0.3);
  }
  select, button {
    margin-top: 15px;
    padding: 10px;
    border: none;
    border-radius: 10px;
  }
  select {
    width: 80%;
  }
  button {
    background-color: #0984e3;
    color: #fff;
    cursor: pointer;
  }
  button:hover {
    background-color: #74b9ff;
  }
  .output {
    margin-top: 20px;
    padding: 15px;
    background-color: rgba(255,255,255,0.1);
    border-radius: 10px;
  }
  .history {
    margin-top: 20px;
    text-align: left;
    background-color: rgba(255,255,255,0.1);
    padding: 15px;
    border-radius: 10px;
  }
</style>
</head>
<body>

<div class="container">
  <h1>üåæ Smart Irrigation Advisor</h1>
  <p>Select your crop and find out whether irrigation is needed today.</p>

  <!-- Crop Selection Dropdown -->
  <select id="cropName">
    <option value="">-- Select Crop --</option>
    <option value="Rice">Rice - ‡§ß‡§æ‡§® - ‡≤Ö‡≤ï‡≥ç‡≤ï‡≤ø</option>
    <option value="Wheat">Wheat - ‡§ó‡•á‡§π‡•Ç‡§Ç - ‡≤ó‡≥ã‡≤ß‡≤ø</option>
    <option value="Sugarcane">Sugarcane - ‡§ó‡§®‡•ç‡§®‡§æ - ‡≤ï‡≤∞‡≤ø‡≤¨‡≥á‡≤≤‡≥Å</option>
    <option value="Maize">Maize - ‡§Æ‡§ï‡•ç‡§ï‡§æ - ‡≤ú‡≥ã‡≤≥</option>
    <option value="Cotton">Cotton - ‡§ï‡§™‡§æ‡§∏ - ‡≤π‡≤§‡≥ç‡≤§‡≤ø</option>
    <option value="Pulses">Pulses - ‡§¶‡§æ‡§≤‡•á‡§Ç - ‡≤¨‡≥á‡≤≥‡≥Ü</option>
    <option value="Groundnut">Groundnut - ‡§Æ‡•Ç‡§Ç‡§ó‡§´‡§≤‡•Ä - ‡≤ï‡≤°‡≤≤‡≥Ü‡≤ï‡≤æ‡≤Ø‡≤ø</option>
    <option value="Millets">Millets - ‡§¨‡§æ‡§ú‡§∞‡§æ - ‡≤∏‡≤ú‡≥ç‡≤ú‡≥Ü</option>
    <option value="Soybean">Soybean - ‡§∏‡•ã‡§Ø‡§æ‡§¨‡•Ä‡§® - ‡≤∏‡≥ã‡≤Ø‡≤æ‡≤¨‡≥Ä‡≤®‡≥ç</option>
    <option value="Sunflower">Sunflower - ‡§∏‡•Ç‡§∞‡§ú‡§Æ‡•Å‡§ñ‡•Ä - ‡≤∏‡≥Ç‡≤∞‡≥ç‡≤Ø‡≤ï‡≤æ‡≤Ç‡≤§‡≤ø</option>
    <option value="Onion">Onion - ‡§™‡•ç‡§Ø‡§æ‡§ú - ‡≤à‡≤∞‡≥Å‡≤≥‡≥ç‡≤≥‡≤ø</option>
    <option value="Tomato">Tomato - ‡§ü‡§Æ‡§æ‡§ü‡§∞ - ‡≤ü‡≥ä‡≤Æ‡≥Ü‡≤ü‡≥ä</option>
  </select>

  <br />
  <button onclick="checkIrrigation()">Check</button>

  <div class="output" id="output"></div>
  <div class="history" id="history">
    <h3>Recent History</h3>
    <ul id="historyList"></ul>
  </div>
</div>

<!-- Firebase SDK -->
<script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-database-compat.js"></script>

<script>
  // ====== FIREBASE CONFIG (replace with your Firebase credentials) ======
  const firebaseConfig = {
    apiKey: "YOUR_FIREBASE_API_KEY",
    authDomain: "YOUR_FIREBASE_APP.firebaseapp.com",
    databaseURL: "https://YOUR_FIREBASE_APP.firebaseio.com",
    projectId: "YOUR_FIREBASE_APP",
    storageBucket: "YOUR_FIREBASE_APP.appspot.com",
    messagingSenderId: "1234567890",
    appId: "YOUR_APP_ID"
  };
  firebase.initializeApp(firebaseConfig);
  const database = firebase.database();

  // ====== WEATHER API ======
  const API_URL = "http://api.weatherapi.com/v1/current.json?key=8fb2a093513741f0a07160359251110";

  async function checkIrrigation() {
    const crop = document.getElementById('cropName').value;
    const outputDiv = document.getElementById('output');
    if (!crop) {
      outputDiv.innerHTML = "<p>Please select a crop.</p>";
      return;
    }

    outputDiv.innerHTML = "<p>Fetching weather data...</p>";

    if (navigator.geolocation) {
      navigator.geolocation.getCurrentPosition(async position => {
        const lat = position.coords.latitude;
        const lon = position.coords.longitude;

        const response = await fetch(`${API_URL}&q=${lat},${lon}&aqi=no`);
        const data = await response.json();

        const temp = data.current.temp_c;
        const humidity = data.current.humidity;
        const condition = data.current.condition.text;
        const rain = data.current.precip_mm;

        const soilMoisture = Math.floor(Math.random() * 100); // random until real sensor

        let adviceEnglish = "";
        let adviceHindi = "";
        let adviceKannada = "";

        if (rain > 2 || humidity > 80) {
          adviceEnglish = "üíß No irrigation needed ‚Äî weather is humid or rainy.";
          adviceHindi = "üíß ‡§∏‡§ø‡§Ç‡§ö‡§æ‡§à ‡§ï‡•Ä ‡§Ü‡§µ‡§∂‡•ç‡§Ø‡§ï‡§§‡§æ ‡§®‡§π‡•Ä‡§Ç ‡§π‡•à ‚Äî ‡§Æ‡•å‡§∏‡§Æ ‡§Ü‡§∞‡•ç‡§¶‡•ç‡§∞ ‡§Ø‡§æ ‡§¨‡§∞‡§∏‡§æ‡§§‡•Ä ‡§π‡•à‡•§";
          adviceKannada = "üíß ‡≤®‡≥Ä‡≤∞‡≤æ‡≤µ‡≤∞‡≤ø ‡≤Ö‡≤ó‡≤§‡≥ç‡≤Ø‡≤µ‡≤ø‡≤≤‡≥ç‡≤≤ ‚Äî ‡≤π‡≤µ‡≤æ‡≤Æ‡≤æ‡≤® ‡≤§‡≥á‡≤µ ‡≤Ö‡≤•‡≤µ‡≤æ ‡≤Æ‡≤≥‡≥Ü‡≤Ø‡≤æ‡≤ó‡≤ø‡≤¶‡≥Ü.";
        } else if (soilMoisture > 60) {
          adviceEnglish = "üå± Soil is moist enough ‚Äî skip irrigation.";
          adviceHindi = "üå± ‡§Æ‡§ø‡§ü‡•ç‡§ü‡•Ä ‡§Æ‡•á‡§Ç ‡§™‡§∞‡•ç‡§Ø‡§æ‡§™‡•ç‡§§ ‡§®‡§Æ‡•Ä ‡§π‡•à ‚Äî ‡§∏‡§ø‡§Ç‡§ö‡§æ‡§à ‡§® ‡§ï‡§∞‡•á‡§Ç‡•§";
          adviceKannada = "üå± ‡≤Æ‡≤£‡≥ç‡≤£‡≥Å ‡≤§‡≥á‡≤µ‡≤µ‡≤æ‡≤ó‡≤ø‡≤¶‡≥Ü ‚Äî ‡≤®‡≥Ä‡≤∞‡≤æ‡≤µ‡≤∞‡≤ø ‡≤¨‡≥á‡≤°.";
        } else {
          adviceEnglish = "üöú Soil is dry ‚Äî irrigation recommended.";
          adviceHindi = "üöú ‡§Æ‡§ø‡§ü‡•ç‡§ü‡•Ä ‡§∏‡•Ç‡§ñ‡•Ä ‡§π‡•à ‚Äî ‡§∏‡§ø‡§Ç‡§ö‡§æ‡§à ‡§ï‡•Ä ‡§∏‡§ø‡§´‡§æ‡§∞‡§ø‡§∂ ‡§ï‡•Ä ‡§ú‡§æ‡§§‡•Ä ‡§π‡•à‡•§";
          adviceKannada = "üöú ‡≤Æ‡≤£‡≥ç‡≤£‡≥Å ‡≤í‡≤£‡≤ó‡≤ø‡≤¶‡≥Ü ‚Äî ‡≤®‡≥Ä‡≤∞‡≤æ‡≤µ‡≤∞‡≤ø ‡≤∂‡≤ø‡≤´‡≤æ‡≤∞‡≤∏‡≥Å ‡≤Æ‡≤æ‡≤°‡≤≤‡≤æ‡≤ó‡≤ø‡≤¶‡≥Ü.";
        }

        outputDiv.innerHTML = `
          <h3>Results for ${crop}</h3>
          <p><strong>Weather:</strong> ${condition}</p>
          <p><strong>Temperature:</strong> ${temp}¬∞C</p>
          <p><strong>Humidity:</strong> ${humidity}%</p>
          <p><strong>Rainfall:</strong> ${rain} mm</p>
          <p><strong>Soil Moisture:</strong> ${soilMoisture}%</p>
          <h3>${adviceEnglish}<br>${adviceHindi}<br>${adviceKannada}</h3>
        `;

        const record = {
          crop: crop,
          temperature: temp,
          humidity: humidity,
          rainfall: rain,
          soilMoisture: soilMoisture,
          advice: `${adviceEnglish} | ${adviceHindi} | ${adviceKannada}`,
          timestamp: new Date().toLocaleString()
        };
        database.ref('irrigation_logs').push(record);

        loadHistory();
      }, () => {
        outputDiv.innerHTML = "<p>Unable to access location. Please enable GPS.</p>";
      });
    } else {
      outputDiv.innerHTML = "<p>Geolocation not supported in this browser.</p>";
    }
  }

  function loadHistory() {
    const list = document.getElementById('historyList');
    list.innerHTML = "";
    database.ref('irrigation_logs').limitToLast(5).on('value', snapshot => {
      list.innerHTML = "";
      snapshot.forEach(data => {
        const entry = data.val();
        const li = document.createElement('li');
        li.innerHTML = `<strong>${entry.crop}</strong> - ${entry.timestamp}<br>${entry.advice}`;
        list.prepend(li);
      });
    });
  }

  loadHistory();
</script>
</body>
</html>
